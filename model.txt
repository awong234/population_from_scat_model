model
{
    # Priors
    p0 ~ dunif(0,1)
    theta ~ dunif(0,100)
    beta0 ~ dnorm(0,0.01) #prior for lambda

    # Time 1 is visit 1, but indexed by 2, since we need to model the initial N. I choose to call that period before any visits time 0.

    for(i in 1:nsites){

        # Need model for N's
        lambda = exp(beta0)
        
        # First N (in time 0) is Poisson random
        N1[i] ~ dpois(lambda) 
        N[i,1] = N1[i]

        # First recruitment (in time 0) is 0
        R[i,1] = 0

        # First detection in time 0 is 0 (we didn't visit any sites in initial deposition).
        p0[i,1] = 0

        # Proceeding N's are a sum of the recruits and the removal of the counts.
        # Recruits are random poisson variates with mean theta.
        for(t in 2:maxT){
            R[i,t] ~ dpois(theta)
            N[i,t] = N[i,t-1] + R[i,t] - y[i,t]
        }
        
        # Observation likelihood. Counts are conditional on population size at previous time step, and detection (which also depends on having visited the site).
        for(t in 2:maxT){                    
            y[i,t] ~ dbinom(N[i,t-1],p0[i,t])
        }        

    }

    


}